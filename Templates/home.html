{% extends "base.html" %}

{% block title %}Home Â· ClassiNews{% endblock %}

{% block content %}
<!-- Hero Section - Clean & Centered -->
<section class="hero-section">
    <div class="hero-content">
        <p class="eyebrow">AI powered topic detection</p>
        <h1>Instantly classify any news article with <span>ClassiNews</span></h1>
        <p class="subtitle">
            Paste a headline or an entire story and let our fine-tuned NLP model
            detect the most relevant news category in milliseconds.
        </p>
    </div>
</section>

<!-- Main Classifier Section - Two Column Layout -->
<section class="classifier-section">
    <div class="classifier-wrapper">
        <div class="classifier-grid">
            <!-- Classifier Panel - Left Side -->
            <div class="classifier-container">
                <div class="classifier-panel">
                    <div class="panel-header">
                        <div>
                            <h2 class="panel-title">Classify Your News</h2>
                            <p class="panel-subtitle">Enter your article or headline below</p>
                        </div>
                        <span class="badge"><i class="fas fa-shield-alt"></i> Secure</span>
                    </div>

                    <div id="errorMessage" class="error-message" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="errorText"></span>
                    </div>

                    <form class="classifier-form" id="classifierForm">
                        <div class="textarea-wrapper">
                            <textarea
                                id="article"
                                name="article"
                                placeholder="Paste or type your news article or headline here..."
                                required></textarea>
                            <div class="textarea-footer">
                                <span class="char-hint">Press Ctrl+Enter to submit</span>
                            </div>
                        </div>
                        <button type="submit" id="submitBtn" class="submit-button">
                            <span>Classify Article</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Results Panel - Right Side -->
            <div class="results-container">
                <div class="results-panel">
                    <div class="results-header">
                        <h3 class="results-title">
                            <i class="fas fa-chart-line"></i>
                            <span>Prediction Result</span>
                        </h3>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="loadingState" class="loading-state" style="display: none;">
                        <div class="loading-animation">
                            <div class="loading-spinner">
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                            </div>
                            <p class="loading-text">Analyzing your article...</p>
                            <div class="loading-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Result Display -->
                    <div id="resultDisplay" class="result-display" style="display: none;">
                        <div class="result-icon-wrapper">
                            <div class="result-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="result-content">
                            <p class="result-label">Category</p>
                            <h2 class="result-category" id="resultCategory"></h2>
                            <div class="result-confidence">
                                <span class="confidence-label">Confidence</span>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" id="confidenceFill"></div>
                                </div>
                                <span class="confidence-value" id="confidenceValue"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="empty-result-state">
                        <div class="empty-icon">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <p class="empty-text">Your prediction will appear here</p>
                        <p class="empty-hint">Enter an article and click classify to get started</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Quick Examples Section - Below Classifier -->
<section class="examples-section">
    <div class="examples-wrapper">
        <h3 class="examples-title">
            <i class="fas fa-lightbulb"></i>
            <span>Try These Examples</span>
        </h3>
        <div class="examples-grid">
            <button type="button" class="example-card sample-btn">
                <div class="example-icon"><i class="fas fa-chart-line"></i></div>
                <p class="example-text">Central bank lifts interest rates amid inflation fears</p>
                <span class="example-category">Business</span>
            </button>
            <button type="button" class="example-card sample-btn">
                <div class="example-icon"><i class="fas fa-futbol"></i></div>
                <p class="example-text">Champions League underdog stuns defending champions</p>
                <span class="example-category">Sports</span>
            </button>
            <button type="button" class="example-card sample-btn">
                <div class="example-icon"><i class="fas fa-rocket"></i></div>
                <p class="example-text">Streaming giant reveals new original sci-fi lineup</p>
                <span class="example-category">Sci/Tech</span>
            </button>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Mark that home page script is loaded to prevent conflicts
    window.homePageScriptLoaded = true;
    
    const form = document.getElementById('classifierForm');
    const submitBtn = document.getElementById('submitBtn');
    const articleInput = document.getElementById('article');
    const errorMessage = document.getElementById('errorMessage');
    const errorText = document.getElementById('errorText');
    
    // Results panel elements
    const emptyState = document.getElementById('emptyState');
    const loadingState = document.getElementById('loadingState');
    const resultDisplay = document.getElementById('resultDisplay');
    const resultCategory = document.getElementById('resultCategory');
    const confidenceFill = document.getElementById('confidenceFill');
    const confidenceValue = document.getElementById('confidenceValue');

    // Category colors mapping
    const categoryColors = {
        'Business': { bg: 'rgba(34, 197, 94, 0.15)', border: 'rgba(34, 197, 94, 0.4)', icon: 'fa-briefcase' },
        'Sports': { bg: 'rgba(59, 130, 246, 0.15)', border: 'rgba(59, 130, 246, 0.4)', icon: 'fa-futbol' },
        'Sci/Tech': { bg: 'rgba(168, 85, 247, 0.15)', border: 'rgba(168, 85, 247, 0.4)', icon: 'fa-rocket' },
        'World': { bg: 'rgba(245, 158, 11, 0.15)', border: 'rgba(245, 158, 11, 0.4)', icon: 'fa-globe' }
    };

    // Sample button functionality
    document.querySelectorAll('.sample-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const text = btn.querySelector('.example-text').textContent;
            articleInput.value = text;
            articleInput.focus();
            articleInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    });

    // AJAX Form submission - No page refresh
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const article = articleInput.value.trim();
        
        if (!article) {
            showError('Please enter an article or headline to classify.');
            return;
        }

        // Hide previous states
        errorMessage.style.display = 'none';
        emptyState.style.display = 'none';
        resultDisplay.style.display = 'none';
        
        // Show loading
        loadingState.style.display = 'block';

        // Show loading state on button
        const originalHTML = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span>Processing...</span><i class="fas fa-spinner fa-spin"></i>';

        try {
            const response = await fetch('/api/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ article: article })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to classify article');
            }

            // Hide loading, show result
            setTimeout(() => {
                loadingState.style.display = 'none';
                displayResult(data);
            }, 500); // Small delay for smooth transition

        } catch (error) {
            loadingState.style.display = 'none';
            showError(error.message || 'An error occurred. Please try again.');
        } finally {
            // Restore button
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalHTML;
        }
    });

    function displayResult(data) {
        const category = data.prediction;
        const confidence = Math.round(data.confidence * 100);
        const categoryInfo = categoryColors[category] || categoryColors['World'];
        
        // Hide empty state
        emptyState.style.display = 'none';
        
        // Update result content
        resultCategory.textContent = category;
        confidenceValue.textContent = confidence + '%';
        confidenceFill.style.width = '0%'; // Reset for animation
        
        // Update icon
        const iconElement = resultDisplay.querySelector('.result-icon i');
        iconElement.className = 'fas ' + categoryInfo.icon;
        
        // Update colors
        resultDisplay.style.background = categoryInfo.bg;
        resultDisplay.style.borderColor = categoryInfo.border;
        confidenceFill.style.background = `linear-gradient(90deg, ${categoryInfo.border}, ${categoryInfo.border}dd)`;
        
        // Show with animation
        resultDisplay.style.display = 'block';
        resultDisplay.classList.add('show');
        
        // Animate confidence bar
        setTimeout(() => {
            confidenceFill.style.width = confidence + '%';
        }, 100);
    }

    function showError(message) {
        errorText.textContent = message;
        errorMessage.style.display = 'flex';
        emptyState.style.display = 'block';
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Ctrl+Enter to submit
    articleInput.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            form.dispatchEvent(new Event('submit'));
        }
    });
</script>
{% endblock %}
